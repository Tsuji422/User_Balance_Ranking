<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>順位表示</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden; /* スクロール禁止 */
        display: flex;
        justify-content: center;
        align-items: center;
        background: transparent; /* 背景透過 */
        font-family: 'Zen Maru Gothic', sans-serif;
      }

      /* 数字表示 */
      #rank {
        font-size: 4rem;
        font-weight: bold;
        color: #555;
        text-align: center;
      }

      /* ランク装飾 */
      .rank-1 {
        color: #d4af37; /* 金 */
        text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
      }
      .rank-2 {
        color: #c0c0c0; /* 銀 */
        text-shadow: 0 0 8px rgba(192, 192, 192, 0.5);
      }
      .rank-3 {
        color: #cd7f32; /* 銅 */
        text-shadow: 0 0 8px rgba(205, 127, 50, 0.5);
      }
    </style>
  </head>
  <body>
    <div id="rank">--</div>

    <script>
      async function fetchRank() {
        const params = new URLSearchParams(window.location.search);
        const userName = params.get("user_name");
        const rankEl = document.getElementById("rank");

        if (!userName) {
          rankEl.textContent = "--";
          return;
        }

        try {
          // ✅ Supabase Edge Function のURLを設定
          const res = await fetch(`https://ddtszhkycoqnffgciucl.supabase.co/functions/v1/GetSheetDataForRankingNomber_v1?user_name=${encodeURIComponent(userName)}`);
          const result = await res.json();

          if (result.error) {
            rankEl.textContent = "--";
            return;
          }

          const rank = result.rank;
          rankEl.textContent = rank;

          // 上位3位に応じて装飾を付ける
          if (rank === 1) rankEl.classList.add("rank-1");
          else if (rank === 2) rankEl.classList.add("rank-2");
          else if (rank === 3) rankEl.classList.add("rank-3");

        } catch (err) {
          rankEl.textContent = "--";
        }
      }

      fetchRank();
    </script>
  </body>
</html>
