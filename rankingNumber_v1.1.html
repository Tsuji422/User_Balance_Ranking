<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rank Only</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      background: transparent; /* 透過のまま */
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    #rank {
      /* 基本サイズ（50x50想定）。桁数でJSが動的に縮めます */
      font-size: 1.6rem;
      font-weight: 800;
      line-height: 1;
      text-align: center;
      color: #555; /* 4位以下は落ち着いたグレー */
      letter-spacing: 0.5px;
      /* 立体感のための軽い影（4位以下） */
      text-shadow:
        0 1px 0 rgba(0,0,0,0.12),
        0 2px 3px rgba(0,0,0,0.10);
      transform: translateY(1px);
    }

    /* ===== 上位3位は“数字だけ”を豪華に ===== */

    /* 金：柔らかいグラデ＋ハイライト＋縁取り風シャドウ */
    .rank-1 {
      background: linear-gradient(180deg, #fff2b5 0%, #f3c94d 35%, #d4af37 70%, #9f7f26 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow:
        0 0.5px 0 rgba(255,255,255,0.7),   /* 上部ハイライト */
        0 1px 0 rgba(152, 112, 14, 0.6),   /* 薄い縁取り */
        0 2px 4px rgba(212, 175, 55, 0.45);/* ゴールドのグロー */
    }

    /* 銀：冷たい艶感 */
    .rank-2 {
      background: linear-gradient(180deg, #ffffff 0%, #e6e6e6 35%, #c0c0c0 70%, #8f8f8f 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow:
        0 0.5px 0 rgba(255,255,255,0.7),
        0 1px 0 rgba(110,110,110,0.6),
        0 2px 4px rgba(180,180,180,0.45);
    }

    /* 銅：温かみのあるメタル感 */
    .rank-3 {
      background: linear-gradient(180deg, #ffe1c2 0%, #e3a56d 35%, #cd7f32 70%, #8a4f1a 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow:
        0 0.5px 0 rgba(255,230,210,0.7),
        0 1px 0 rgba(112,62,20,0.6),
        0 2px 4px rgba(205,127,50,0.45);
    }
  </style>
</head>
<body>
  <div id="rank">--</div>

  <script>
    async function fetchRank() {
      const params = new URLSearchParams(window.location.search);
      const userName = params.get("user_name");
      const rankEl = document.getElementById("rank");

      if (!userName) {
        rankEl.textContent = "--";
        return;
      }

      try {
        // ← Edge Function のURLに差し替え
        const url = `https://ddtszhkycoqnffgciucl.supabase.co/functions/v1/GetSheetDataForRankingNomber_v1?user_name=${encodeURIComponent(userName)}`;
        const res = await fetch(url);
        const result = await res.json();

        if (!result || result.error || result.rank == null) {
          rankEl.textContent = "--";
          return;
        }

        const rank = Number(result.rank);
        rankEl.textContent = rank;

        // 上位3位だけ豪華スタイルを付与
        if (rank === 1) rankEl.classList.add("rank-1");
        else if (rank === 2) rankEl.classList.add("rank-2");
        else if (rank === 3) rankEl.classList.add("rank-3");

        // 50x50に確実に収める：桁数でフォント自動縮小
        adjustFontSize(rankEl, rank);

      } catch (e) {
        rankEl.textContent = "--";
      }
    }

    function adjustFontSize(el, rank) {
      // ベースは 1.6rem。2桁/3桁で段階的に縮小
      const digits = String(rank).length;
      if (digits >= 3) {
        el.style.fontSize = "1.1rem";     // 100位など
      } else if (digits === 2) {
        el.style.fontSize = "1.35rem";    // 10~99位
      } else {
        el.style.fontSize = "1.6rem";     // 1桁
      }
    }

    fetchRank();
  </script>
</body>
</html>
