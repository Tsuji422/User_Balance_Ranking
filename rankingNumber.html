<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>順位表示</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent; /* 背景透過 */
      }

      #rank {
        font-size: 1.8rem; /* ← WebView 50×50に合わせて最適化 */
        font-weight: 700;
        color: #444;
        line-height: 1;
        text-align: center;
      }

      /* 上位3位用カラー */
      .rank-1 {
        color: #d4af37;
        text-shadow: 0 0 3px rgba(212, 175, 55, 0.6);
      }
      .rank-2 {
        color: #c0c0c0;
        text-shadow: 0 0 3px rgba(192, 192, 192, 0.6);
      }
      .rank-3 {
        color: #cd7f32;
        text-shadow: 0 0 3px rgba(205, 127, 50, 0.6);
      }
    </style>
  </head>
  <body>
    <div id="rank">--</div>

    <script>
      async function fetchRank() {
        const params = new URLSearchParams(window.location.search);
        const userName = params.get("user_name");
        const rankEl = document.getElementById("rank");

        if (!userName) {
          rankEl.textContent = "--";
          return;
        }

        try {
          const res = await fetch(
            `https://ddtszhkycoqnffgciucl.supabase.co/functions/v1/GetSheetDataForRankingNomber_v1?user_name=${encodeURIComponent(userName)}`
          );
          const result = await res.json();

          if (!result || result.error || !result.rank) {
            rankEl.textContent = "--";
            return;
          }

          const rank = Number(result.rank);
          rankEl.textContent = rank;

          if (rank === 1) rankEl.classList.add("rank-1");
          else if (rank === 2) rankEl.classList.add("rank-2");
          else if (rank === 3) rankEl.classList.add("rank-3");
        } catch (err) {
          rankEl.textContent = "--";
        }
      }

      fetchRank();
    </script>
  </body>
</html>
